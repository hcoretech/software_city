"use strict";(()=>{var e={};e.id=179,e.ids=[179],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4011:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>b,serverHooks:()=>x,staticGenerationAsyncStorage:()=>R});var a={};r.r(a),r.d(a,{POST:()=>v});var o=r(9303),s=r(8716),n=r(670),i=r(4330);r(166);var u=r(7070),p=r(8013);let l=require("node:fs/promises");var d=r.n(l);let c=require("node:fs");var m=r(618);let f=new p.MongoClient(process.env.MONGODB_URL).db(),g=new p.GridFSBucket(f,{bucketName:"upload",chunkSizeBytes:262144,readPreference:p.ReadPreference.secondary});async function v(e){let t=await e.formData(),r=t.get("file"),a=t.get("title"),o=new Uint8Array(await r.arrayBuffer());try{if(!r)return u.NextResponse.json({messsage:"no valid file"},{status:400});return await d().writeFile(`./public/${r.name}`,o,null),(0,c.createReadStream)(`./public/${r.name}`).pipe(g.openUploadStream(r.name,{metadata:{name:a,bufferArray:"henry"}})).closed,(()=>{let e=setInterval(()=>{d().unlink(`./public/${r.name}`).then(e=>{console.log("file deleted succesfully")}).catch(e=>{console.log("failed to delete")})},100);setTimeout(()=>{clearInterval(e)},160)})(),u.NextResponse.json({message:"sucess"},{status:200})}catch(e){return u.NextResponse.json({message:"error posting to db"},{status:501})}}(0,m.h)([v]),(0,i.j)("3e76ce831b9d4440fbd11e38b913e1c9d039f8b6",v);let b=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/postRoute/route",pathname:"/api/postRoute",filename:"route",bundlePath:"app/api/postRoute/route"},resolvedPagePath:"C:\\Users\\Hcore\\Desktop\\project\\app\\api\\postRoute\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:R,serverHooks:x}=b,y="/api/postRoute/route";function w(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:R})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[293,972],()=>r(4011));module.exports=a})();